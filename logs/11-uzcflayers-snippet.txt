                 begin
                      PGDBLayerProp(Item.Data)^.LT:=SelectorForm.data;
                      result:=true;
                 end;
  freeandnil(SelectorForm);
end;
{layer LineWidth handle procedures}
procedure TLayersForm.LWSubitemDraw(aCanvas:TCanvas; Item: TListItem; SubItem:Integer; State: TCustomDrawState);
var
   colorindex,ll:integer;
   s:string;
   //y:integer;
   //textrect:TRect;
   ARect: TRect;
   //ts:TTextStyle;
begin
  ARect:=ListViewDrawSubItem(state,aCanvas,Item,SubItem);
  colorindex:=PGDBLayerProp(Item.Data)^.lineweight;
  s:=GetLWNameFromLW(colorindex);
  if colorindex<0 then
             ll:=0
         else
             ll:=30;
   drawLW(aCanvas,ARect,ll,(colorindex) div 10,s);
end;
function TLayersForm.GetLineWeightName(Item: TListItem):string;
begin
     result:=GetLWNameFromLW(PGDBLayerProp(Item.Data)^.lineweight);
end;

function TLayersForm.LayerLWClick(Item: TListItem;r: TRect):boolean;
var
   mr:integer;
begin
  if not assigned(LineWeightSelectForm)then
  Application.CreateForm(TLineWeightSelectForm, LineWeightSelectForm);
  zcUI.Do_BeforeShowModal(LineWeightSelectForm);
  mr:=LineWeightSelectForm.run(PGDBLayerProp(Item.Data)^.lineweight,false);
  zcUI.Do_AfterShowModal(LineWeightSelectForm);
  if mr=ZCmrOk then
                 begin
                      PGDBLayerProp(Item.Data)^.lineweight:=LineWeightSelectForm.SelectedLW;
                      Item.SubItems[6]:=GetLWNameFromLW(LineWeightSelectForm.SelectedLW);
                      result:=true;
                 end;
  freeandnil(LineWeightSelectForm);
end;
{layer description handle procedures}
function TLayersForm.createdesceditor(Item: TListItem;r: TRect):boolean;
begin
  result:=SupportTypedEditors.createeditor(ListView1,Item,r,PGDBLayerProp(Item.Data)^.desk,'AnsiString',@CreateUndoStartMarkerNeeded,r.Bottom-r.Top,drawings.GetUnitsFormat);
end;
function TLayersForm.GetDescName(Item: TListItem):string;
begin
     result:=PGDBLayerProp(Item.Data)^.desk;
end;



procedure TLayersForm.FormCreate(Sender: TObject);
begin
  ActionList1.Images:=ImagesManager.IconList;
  ToolBar1.Images:=ImagesManager.IconList;
  AddLayer.ImageIndex:=ImagesManager.GetImageIndex('plus');
  DelLayer.ImageIndex:=ImagesManager.GetImageIndex('minus');
  MkCurrentLayer.ImageIndex:=ImagesManager.GetImageIndex('ok');;
  PurgeLayers.ImageIndex:=ImagesManager.GetImageIndex('Purge');
  RefreshLayers.ImageIndex:=ImagesManager.GetImageIndex('Refresh');

  SupportTypedEditors:=TSupportTypedEditors.create;
  SupportTypedEditors.OnUpdateEditedControl:=@ListView1.UpdateItem2;
  IsUndoEndMarkerCreated:=false;

ListView1.SmallImages:=ImagesManager.IconList;
ListView1.DefaultItemIndex:=ImagesManager.GetImageIndex('ok');;

setlength(ListView1.SubItems,ColumnCount);

with ListView1.SubItems[NameColumn] do
begin
     OnClick:=@createnameeditor;
     OnGetName:=@GetLayerName;
end;
with ListView1.SubItems[LockColumn] do
begin
     OnImageIndex:=ImagesManager.GetImageIndex('lock');
     OffImageIndex:=ImagesManager.GetImageIndex('unlock');
     OnClick:=@LayerLockClick;
     IsOn:=@IsLayerLock;
end;
with ListView1.SubItems[FrezeColumn] do
begin
     OnImageIndex:=ImagesManager.GetImageIndex('freze');;
     OffImageIndex:=ImagesManager.GetImageIndex('unfreze');
     IsOn:=@IsLayerFreze;
end;
with ListView1.SubItems[OnColumn] do
begin
     OnImageIndex:=ImagesManager.GetImageIndex('on');
     OffImageIndex:=ImagesManager.GetImageIndex('off');
     OnClick:=@LayerOnClick;
